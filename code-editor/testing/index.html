<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Text Code Editor with Live Edit Sync</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/theme/dracula.css">
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/htmlmixed/htmlmixed.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-beautify/js/lib/beautify-html.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background: #1e1e1e;
      color: white;
    }
    select, button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      background: #333;
      color: white;
      border: none;
    }
    .editor-container, .preview-container {
      display: none;
      flex-direction: column;
      height: calc(100vh - 50px);
    }
    .editor-container.active, .preview-container.active {
      display: flex;
    }
    .editor-wrapper { flex: 1; overflow: auto; }
    .CodeMirror { height: 100%; font-size: 14px; }
    iframe { flex: 1; width: 100%; border: none; background: white; }
    .button-bar { display: flex; position: sticky; bottom: 0; background: #1e1e1e; z-index: 999; }
    .output-title { text-align: center; padding: 10px; background: #222; }
    .watermark { text-align: center; font-size: 11px; color: #999; padding: 6px; }
  </style>
</head>
<body>  <select onchange="changeMode(this.value)">
    <option value="htmlmixed">HTML</option>
    <option value="css">CSS</option>
    <option value="javascript">JavaScript</option>
    <option value="null">Plain Text</option>
  </select>  <div class="editor-container active" id="editorBox">
    <div class="editor-wrapper">
      <textarea id="editor">
<h1 id="demo">Click me in preview</h1>
<script>
document.getElementById("demo").onclick = () => alert("Clicked!");
</script>
      </textarea>
    </div>
    <div class="button-bar">
      <button onclick="handleRun()">Run Code</button>
    </div>
  </div>  <div class="preview-container" id="previewBox">
    <div class="output-title">Live Output</div>
    <iframe id="preview"></iframe>
    <div class="watermark">© 2025 JSN01000111 – Educational Use</div>
    <div class="button-bar">
      <button onclick="toggleView('editor')">Back to Editor</button>
    </div>
  </div>  <script>
    const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
      lineNumbers: true,
      mode: "htmlmixed",
      theme: "dracula",
      lineWrapping: false,
      viewportMargin: Infinity
    });

    function changeMode(mode) {
      editor.setOption("mode", mode);
    }

    function handleRun() {
      const code = html_beautify(editor.getValue(), { indent_size: 2 });
      editor.setValue(code);
      runCode(code);
      toggleView("preview");
    }

    function runCode(code) {
      const iframe = document.getElementById("preview");
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(code);
      doc.close();

      const script = doc.createElement("script");
      script.innerHTML = `
        let selectedEl = null;
        document.body.addEventListener("click", function(e) {
          e.preventDefault();
          selectedEl = e.target;
          const newText = prompt("Edit element content:", selectedEl.innerHTML);
          if (newText !== null) {
            selectedEl.innerHTML = newText;
            parent.updateEditorHTML(selectedEl.outerHTML, selectedEl.id);
          }
        });
      `;
      doc.body.appendChild(script);
    }

    function toggleView(view) {
      document.getElementById("editorBox").classList.toggle("active", view === "editor");
      document.getElementById("previewBox").classList.toggle("active", view === "preview");
    }

    // Sync back changes to CodeMirror
    function updateEditorHTML(newOuterHTML, id) {
      const code = editor.getValue();
      const parser = new DOMParser();
      const doc = parser.parseFromString(code, 'text/html');
      const el = doc.getElementById(id);
      if (el) {
        el.outerHTML = newOuterHTML;
        const newHTML = html_beautify(doc.body.innerHTML, { indent_size: 2 });
        editor.setValue(newHTML);
      }
    }
  </script></body>
</html>
