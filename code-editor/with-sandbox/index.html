<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Text Code Editor with Lint</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5/theme/dracula.css">
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      background: #1e1e1e; color: #fff; font-family: sans-serif;
    }
    select, button {
      width: 100%; padding: 12px; font-size: 16px;
      background: #333; color: #fff; border: none;
    }
    .editor-container, .preview-container { display: none; flex-direction: column; height: calc(100vh - 50px); }
    .editor-container.active, .preview-container.active { display: flex; }
    .editor-wrapper { flex: 1; }
    .CodeMirror { height: 100%; font-size: 14px; }
    .button-bar { display: flex; background: #222; }
    .button-bar button { flex: 1; border-top: 1px solid #555; }
    iframe { flex: 1; width: 100%; border: none; background: white; }
    .output-title, .watermark { text-align: center; padding: 8px; background: #222; font-size: 14px; }
    .lint-results { padding: 10px; font-size: 13px; white-space: pre-wrap; background: #111; color: #faa; overflow-y: auto; max-height: 200px; }
  </style>
</head>
<body>

<select onchange="changeMode(this.value)">
  <option value="htmlmixed">HTML</option>
  <option value="css">CSS</option>
  <option value="javascript">JavaScript</option>
  <option value="null">Plain Text</option>
</select>

<div class="editor-container active" id="editorBox">
  <div class="editor-wrapper">
    <textarea id="editor"></textarea>
  </div>
  <div id="lintResults" class="lint-results"></div>
  <div class="button-bar">
    <button onclick="handleRun()">Run Code</button>
  </div>
</div>

<div class="preview-container" id="previewBox">
  <div class="output-title">Live Output</div>
  <iframe id="preview"></iframe>
  <div class="watermark">© 2025 JSN01000111 – Educational Use</div>
  <div class="button-bar">
    <button onclick="toggleView('editor')">Back to Editor</button>
  </div>
</div>

<!-- CodeMirror & Lint Engines -->
<script src="https://cdn.jsdelivr.net/npm/codemirror@5/lib/codemirror.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/htmlmixed/htmlmixed.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/javascript/javascript.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/css/css.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5/mode/xml/xml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-beautify/js/lib/beautify-html.js"></script>

<!-- Linters -->
<script src="https://cdn.jsdelivr.net/npm/jshint@2.13.6/dist/jshint.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/csslint@1.0.5/dist/csslint.js"></script>
<script src="https://cdn.jsdelivr.net/gh/htmlhint/htmlhint@0.15.0/dist/htmlhint.min.js"></script>

<script>
  const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
    lineNumbers: true,
    mode: "htmlmixed",
    theme: "dracula",
    lineWrapping: false,
    viewportMargin: Infinity
  });

  function changeMode(mode) {
    editor.setOption("mode", mode);
    editor.setValue(""); // Optional: clear when switching
    document.getElementById("lintResults").innerHTML = "";
  }

  function handleRun() {
    const mode = editor.getOption("mode");
    const code = editor.getValue();
    const output = document.getElementById("lintResults");
    output.innerHTML = "";

    if (mode === "htmlmixed") {
      const results = HTMLHint.verify(code);
      if (results.length) {
        results.forEach(r => output.innerHTML += `Line ${r.line}, Col ${r.col}: ${r.message}<br>`);
      } else {
        output.innerHTML = "<span style='color:lightgreen;'>No HTML errors</span>";
      }
    } else if (mode === "css") {
      const results = CSSLint.verify(code).messages;
      if (results.length) {
        results.forEach(r => output.innerHTML += `Line ${r.line || "?"}: ${r.message}<br>`);
      } else {
        output.innerHTML = "<span style='color:lightgreen;'>No CSS errors</span>";
      }
    } else if (mode === "javascript") {
      JSHINT(code);
      const results = JSHINT.errors;
      if (results && results.length) {
        results.forEach(r => {
          if (r) output.innerHTML += `Line ${r.line}, Col ${r.character}: ${r.reason}<br>`;
        });
      } else {
        output.innerHTML = "<span style='color:lightgreen;'>No JavaScript errors</span>";
      }
    }

    if (mode === "htmlmixed") {
      runCode(code); toggleView("preview");
    } else {
      toggleView("preview");
      runCode(`<pre style="padding:1em;color:black;background:#fefefe;">${code}</pre>`);
    }
  }

  function runCode(code) {
    const iframe = document.getElementById("preview");
    const doc = iframe.contentDocument || iframe.contentWindow.document;
    doc.open(); doc.write(code); doc.close();
  }

  function toggleView(view) {
    document.getElementById("editorBox").classList.toggle("active", view === "editor");
    document.getElementById("previewBox").classList.toggle("active", view === "preview");
  }
</script>

</body>
</html>
